<!doctype html>

<meta charset="UTF-8">
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">

<style>
#conteudo {
    margin: 50px auto;
    width: 960px;
    text-align: center;
}

#tabela {
    margin: 0 auto;
}

td {
    text-align: center;
    min-width: 90px;
    padding: 10px 0;
}

tbody tr:hover {
    background-color: #f5f5f5;
}

thead td {
    cursor: pointer;
    user-select: none;
    font-weight: bold;
}

</style>

<title>Table Top - DigitalDesk</title>

<div id="conteudo">
    <h1>Ticket to ride</h1>

    <table id="tabela">
        <thead>
            <tr>
                <td ordenacao="nome">Jogador</td>
                <td ordenacao="jogos">Jogos</td>
                <td ordenacao="vitorias">Vit√≥rias</td>
                <td ordenacao="aproveitamento">Aproveitamento</td>
            </tr>
        </thead>
        <tbody id="corpo">
        </tbody>
    </table>
</div>

<script>
/*
historico
----------------
27/08/2018
igor 108
gabriel 115
fred 124
----------------
*/
    
const aproveitamento = ({ jogos, vitorias }) => vitorias / jogos

const dados = [
    { nome: 'Gabriel', jogos: 1, vitorias: 0 },
    { nome: 'Fred', jogos: 1, vitorias: 1 },
    { nome: 'Felipe', jogos: 0, vitorias: 0 },
    { nome: 'Nico', jogos: 0, vitorias: 0 },
    { nome: 'Igor', jogos: 1, vitorias: 0 }
].map(x => ({ ...x, aproveitamento: aproveitamento(x) * 100 || 0.0 }))

const ordenador = attr => (a, b) => typeof a[attr] === 'string'
                                    ? a[attr] > b[attr]
                                    : a[attr] < b[attr]

const criarLinha = textosCelulas => {
    const tr = document.createElement('tr')

    textosCelulas.map(texto => {
        const td = document.createElement('td')
        td.textContent = texto
        return td
    }).forEach(tr.appendChild.bind(tr))

    return tr
}

const popularTabela = dados => {
    const tbody = document.getElementById('corpo')

    for (const x of dados) {
        tbody.appendChild(criarLinha([
            x.nome,
            x.jogos,
            x.vitorias,
            x.aproveitamento.toFixed(2) + '%'
        ]))
    }
}

const limparTabela = () => {
    const tbody = document.getElementById('corpo')
    tbody.parentNode.replaceChild(tbody.cloneNode(false), tbody)
}

window.addEventListener('load', () => {
    document.querySelectorAll('thead td').forEach(td => {
        td.addEventListener('click', () => {
            limparTabela()
            const prop = td.getAttribute('ordenacao')
            popularTabela(dados.sort(ordenador(prop)))
        })
    })

    popularTabela(dados.sort(ordenador('vitorias')))
})
</script>
